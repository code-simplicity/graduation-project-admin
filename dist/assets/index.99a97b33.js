import{T as e}from"./index.c3d311dd.js";import{d as a}from"./utils.3dd1a93e.js";import{q as t,d as l,L as o,k as s,j as r,_ as n,r as i,o as p,z as d,w as u,b as c,c as m,K as h,M as g,a as f,A as b,B as w,C as _,f as v}from"./index.a5d69c1c.js";import{P as y,g as D}from"./portmappoint.1a4f3057.js";import{s as M}from"./point.12d7b59d.js";const C=l({components:{Layer:o,Plus:y},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"600px"})}},setup(e){const a=s(null),t=s(null),l=s({}),o=r({pageNum:1,pageSize:40}),n=s([]),i=s([]),p=s(null),d=()=>{D().then((e=>{n.value=e.data})).catch((e=>{ElMessage.error(res.msg)}))};return d(),{layerDom:a,formRef:t,modeForm:l,rules:{point_id:[{required:!0,message:"请选择需要对应的点位",trigger:"blur"}]},pointList:i,portMapPointData:n,page:o,uploadRef:p,getPortMapPointData:d,changePortPointMap:e=>{if(e){const a={pageNum:o.pageNum,pageSize:o.pageSize,port_point_map_id:e};M(a).then((e=>{let a=e.data.list;i.value=a})).catch((e=>{ElMessage.success(e),i.value=[],o.pageNum=1,o.total=0}))}}}},methods:{submit(){this.formRef&&this.formRef.validate((e=>{if(e){let e=this.modeForm,a=this.uploadRef.uploadFiles;if(this.layer.row){let t=this.layer.row.id;this.httpRequest(a,e,t)}else this.httpRequest(a,e)}}))},httpRequest(e,a,l){const o=new FormData;e.forEach((e=>{o.append("image",e.raw)})),o.append("point_id",a.point_id),l?(o.append("id",l),(e=>t({url:"/wavestats/update",method:"post",data:e}))(o).then((e=>{ElMessage.success(e.msg)})).catch((e=>{ElMessage.error(res.msg),console.log("err",e)}))):(e=>t({url:"/wavestats/upload",method:"post",data:e}))(o).then((e=>{ElMessage.success({message:e.msg})})).catch((e=>{ElMessage.error(res.msg)})),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()}}}),E=f("div",{class:"el-upload__tip"},"请选择波形统计图，格式为jpg/png",-1);const S=l({name:"WaveStats",components:{Table:e,Upload:n(C,[["render",function(e,a,t,l,o,s){const r=i("plus"),n=i("el-icon"),f=i("el-upload"),b=i("el-form-item"),w=i("el-option"),_=i("el-select"),v=i("el-form"),y=i("Layer");return p(),d(y,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:u((()=>[c(v,{ref:"formRef",model:e.modeForm,rules:e.rules,"label-width":"120px"},{default:u((()=>[c(b,{label:"波形统计图",prop:"image"},{default:u((()=>[c(f,{ref:"uploadRef",action:"","list-type":"picture-card",name:"image",accept:".jpg, .png",limit:"1","auto-upload":!1,"http-request":e.httpRequest},{tip:u((()=>[E])),default:u((()=>[c(n,null,{default:u((()=>[c(r)])),_:1})])),_:1},8,["http-request"])])),_:1}),c(b,{label:"港口点位地图",prop:"port_point_map_id"},{default:u((()=>[c(_,{modelValue:e.modeForm.port_point_map_id,"onUpdate:modelValue":a[0]||(a[0]=a=>e.modeForm.port_point_map_id=a),placeholder:"请选择港口点位地图",clearable:"",onChange:e.changePortPointMap},{default:u((()=>[(p(!0),m(g,null,h(e.portMapPointData,(e=>(p(),d(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),c(b,{label:"点位表",prop:"point_id"},{default:u((()=>[c(_,{modelValue:e.modeForm.point_id,"onUpdate:modelValue":a[1]||(a[1]=a=>e.modeForm.point_id=a),placeholder:"请选择点位表，根据点位表分类选择",clearable:""},{default:u((()=>[(p(!0),m(g,null,h(e.pointList,(e=>(p(),d(w,{key:e.id,label:e.content,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["layer","onConfirm"])}]])},setup(){const e=s(!0),l=s([]),o=r({pageNum:1,pageSize:10,total:0}),n=r({show:!1,title:"添加波形统计图",showButton:!0,width:"600px"}),i=s([]),p=a=>{e.value=!0,a&&(o.pageNum=1);const s={pageNum:o.pageNum,pageSize:o.pageSize};var r;(r=s,t({url:"/wavestats/findAll",method:"post",data:r})).then((e=>{let a=e.data.list;l.value=a,o.total=Number(e.data.total)})).catch((e=>{ElMessage.error(e),l.value=[],o.pageNum=1,o.total=0})).finally((()=>{e.value=!1}))};return p(!0),{loading:e,tableData:l,page:o,chooseData:i,baseURL:"http://8.131.240.89:5050/wavestats/search?id=",dateFormat:a,layer:n,getTableData:p,handleSelectionChange:e=>{i.value=e},uploadWaveStats:()=>{n.title="添加波形统计图",n.show=!0,n.width="600px"},handleBatchDel:e=>{let a=[];e.map((e=>{a.push(e.id)}));var o;(o={wavestatsIds:a},t({url:"/wavestats/batch/delete",method:"post",data:o})).then((e=>{ElMessage.success(e.msg),p(1===l.value.length)})).catch((e=>{ElMessage.error(e)}))},handleEdit:e=>{n.title="编辑波形统计图",n.show=!0,n.row=e,n.width="600px"},handleDel:e=>{if(e){(e=>t({url:"/wavestats/delete",method:"get",params:e}))({id:e.id}).then((e=>{ElMessage.success(e.msg),p(1===l.value.length)})).catch((e=>{ElMessage.error(e)}))}}}}}),R={class:"layout-container"},F={class:"layout-container-form flex space-between"},x={class:"layout-container-form-handle"},T=v("上传波形统计图"),N=v("批量删除"),P={class:"layout-container-table"},j=v("编辑"),k=v("删除");var q=n(S,[["render",function(e,a,t,l,o,s){const r=i("el-button"),n=i("el-popconfirm"),h=i("el-table-column"),g=i("el-image"),v=i("Table"),y=i("Upload"),D=b("loading");return p(),m("div",R,[f("div",F,[f("div",x,[c(r,{type:"primary",icon:"el-icon-plus",onClick:e.uploadWaveStats},{default:u((()=>[T])),_:1},8,["onClick"]),c(n,{title:"批量删除",onConfirm:a[0]||(a[0]=a=>e.handleBatchDel(e.chooseData))},{reference:u((()=>[c(r,{type:"danger",icon:"el-icon-delete",disabled:0===e.chooseData.length},{default:u((()=>[N])),_:1},8,["disabled"])])),_:1})])]),f("div",P,[w(c(v,{ref:"table",page:e.page,"onUpdate:page":a[1]||(a[1]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:u((()=>[c(h,{prop:"id",label:"id",align:"center","show-overflow-tooltip":""}),c(h,{prop:"point_id",label:"点位表id",align:"center","show-overflow-tooltip":""}),c(h,{prop:"url",label:"图片路径",align:"center",width:"70","show-overflow-tooltip":""}),c(h,{prop:"path",label:"图片存储路径",align:"center"},{default:u((a=>[c(g,{class:"image-style",src:e.baseURL+a.row.id,fit:e.cover},null,8,["src","fit"])])),_:1}),c(h,{prop:"type",label:"图片类型",align:"center",width:"80"}),c(h,{prop:"name",label:"图片名称",align:"center",width:"80"}),c(h,{prop:"state",label:"状态",align:"center",width:"60"}),c(h,{prop:"create_time",label:"创建时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),c(h,{prop:"update_time",label:"更新时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),c(h,{label:"操作",align:"center",fixed:"right",width:"180"},{default:u((a=>[c(r,{onClick:t=>e.handleEdit(a.row)},{default:u((()=>[j])),_:2},1032,["onClick"]),c(n,{title:"删除",onConfirm:t=>e.handleDel(a.row)},{reference:u((()=>[c(r,{type:"danger"},{default:u((()=>[k])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData","onSelectionChange"]),[[D,e.loading]]),e.layer.show?(p(),d(y,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):_("",!0)])])}],["__scopeId","data-v-c52ba8b2"]]);export{q as default};
