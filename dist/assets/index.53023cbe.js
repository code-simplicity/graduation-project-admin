import{g as e,s as t}from"./choose.f9744687.js";import{d as a,k as o,j as l,N as s,_ as n,x as r,A as c,o as i,c as d,B as u,a as m,M as p,K as h,n as g,t as f,p as v,e as b,q as w,L as y,r as _,z as C,w as D,b as N,O as S,C as x,f as T,P as k}from"./index.a5d69c1c.js";import{S as F}from"./Search.02417c9e.js";import{T as z}from"./index.c3d311dd.js";import{d as A}from"./utils.3dd1a93e.js";const j=a({components:{Search:F},setup(){const a=o(null),n=l({pageNum:1,pageSize:20,total:0});let c=o([]),i=o(""),d=s("active");const u=()=>{const t={pageNum:n.pageNum,pageSize:n.pageSize};e(t).then((e=>{let t=e.data.list;c.value=t,d.value=e.data.list[0]})).catch((e=>{r.error(e),console.log("err",e),c.value=[]}))};return u(),{listDom:a,page:n,list:c,search:i,active:d,getChooseAll:u,changeActive:e=>{d.value=e},handleSearch:e=>{if(e){const e={id:i.value};t(e).then((e=>{r.success(e.msg)})).catch((e=>{r.error(res.msg)}))}}}}}),V={class:"choose"},L=(e=>(v("data-v-1b67afc0"),e=e(),b(),e))((()=>m("div",{class:"header-box"},[m("h2",null,"选择列表")],-1))),G={class:"list system-scrollbar",style:{overflow:"auto"},"infinite-scroll-immediate":!1,ref:"listDom"},I=["onClick"];var O=n(j,[["render",function(e,t,a,o,l,s){const n=c("infinite-scroll");return i(),d("div",V,[L,u(m("ul",G,[(i(!0),d(p,null,h(e.list,(t=>(i(),d("li",{key:t.id,class:g({active:t.id===e.active.id}),onClick:a=>e.changeActive(t)},[m("span",null,f(t.content),1)],10,I)))),128))],512),[[n,e.getChooseAll]])])}],["__scopeId","data-v-1b67afc0"]]);const R=e=>w({url:"content/add",method:"post",data:e}),B=e=>w({url:"content/add/choose_id",method:"post",data:e}),U=e=>w({url:"/content/update",method:"post",data:e}),q=a({components:{Layer:y},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"600px"})}},setup(t){const a=o(null),l=o(null),s=o({content:""}),n=o([]),c=t=>{if(t){e({pageNum:1,pageSize:20}).then((e=>{let t=e.data.list;n.value=t})).catch((e=>{r.error({message:"获取分类失败"}),console.log("err",e)}))}};return t.layer.row&&(s.value=JSON.parse(JSON.stringify(t.layer.row))),c(!0),{layerDom:a,formRef:l,modeForm:s,rules:{content:[{required:!0,message:"请输入内容",trigger:"blur"}]},list:n,getChooseAll:c}},methods:{submit(){this.formRef&&this.formRef.validate((e=>{if(e){let e=this.modeForm;this.layer.row?U(e):e.choose_id?B(e):R(e),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()}}))},addContent(e){const t={content:e.content};R(t).then((e=>{r.success({message:e.msg})})).catch((e=>{r.error(res.msg)}))},addContentChoose(e){B(e).then((e=>{r.success({message:e.msg})})).catch((e=>{r.error(res.msg)}))},updateContent(e){U(e).then((e=>{r.success(e.msg)})).catch((e=>{r.error(res.msg)}))}}});const E=a({name:"ContentTable",components:{Table:z,Layer:n(q,[["render",function(e,t,a,o,l,s){const n=_("el-option"),r=_("el-select"),c=_("el-form-item"),u=_("el-input"),m=_("el-form"),g=_("Layer",!0);return i(),C(g,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:D((()=>[N(m,{ref:"formRef",model:e.modeForm,rules:e.rules,"label-width":"80px"},{default:D((()=>[N(c,{label:"分类选择",prop:"choose_id"},{default:D((()=>[N(r,{modelValue:e.modeForm.choose_id,"onUpdate:modelValue":t[0]||(t[0]=t=>e.modeForm.choose_id=t),placeholder:"请选择对应的分类",clearable:""},{default:D((()=>[(i(!0),d(p,null,h(e.list,(e=>(i(),C(n,{key:e.id,label:e.content,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),N(c,{label:"内容",prop:"content"},{default:D((()=>[N(u,{modelValue:e.modeForm.content,"onUpdate:modelValue":t[1]||(t[1]=t=>e.modeForm.content=t),placeholder:"请输入选择内容",autosize:"",type:"textarea",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["layer","onConfirm"])}]])},setup(){const e=o(!0),t=o([]),a=l({pageNum:1,pageSize:10,total:0,choose_id:""}),n=s("active"),c=l({show:!1,title:"添加内容",showButton:!0,width:"600px"}),i=o=>{e.value=!0,o&&(a.pageNum=1);let l={pageNum:a.pageNum,pageSize:a.pageSize,choose_id:n.value.id};var s;""===l.choose_id?(s=l,w({url:"/content/findAll",method:"post",data:s})).then((o=>{let l=o.data.list;t.value=l,a.total=Number(o.data.total),e.value=!1})).catch((o=>{r.error(res.msg),e.value=!1,t.value=[],a.pageNum=1,a.total=0,e.value=!1})):(e=>w({url:"/content/search/choose_id",method:"post",data:e}))(l).then((o=>{let l=o.data.list;t.value=l,a.total=Number(o.data.total),e.value=!1})).catch((o=>{r.error(res.msg),e.value=!1,t.value=[],a.pageNum=1,a.total=0,e.value=!1}))};return S(n,(e=>{i(!0)})),{dateFormat:A,loading:e,tableData:t,page:a,layer:c,handleAddContent:()=>{c.title="添加内容",c.show=!0,c.width="600px"},getTableData:i,handleEdit:e=>{c.title="修改内容",c.show=!0,c.row=e,c.width="600px"},handleDel:e=>{(e=>w({url:"/content/delete",method:"get",params:e}))({id:e.id}).then((e=>{r.success(e.msg),i(1===t.value.length)})).catch((e=>{r.success(e)}))}}}}),J={class:"layout-container"},K={class:"layout-container-form flex space-between"},M={class:"layout-container-form-handle"},P=T("添加内容"),$={class:"layout-container-table"},H=T("编辑"),Q=T("删除");const W=a({name:"ContentSetting",components:{Choose:O,ContentTable:n(E,[["render",function(e,t,a,o,l,s){const n=_("el-button"),r=_("el-table-column"),p=_("el-popconfirm"),h=_("Table"),g=_("Layer"),f=c("loading");return i(),d("div",J,[m("div",K,[m("div",M,[N(n,{type:"primary",icon:"el-icon-plus",onClick:e.handleAddContent},{default:D((()=>[P])),_:1},8,["onClick"])])]),m("div",$,[u(N(h,{ref:"table",page:e.page,"onUpdate:page":t[0]||(t[0]=t=>e.page=t),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData},{default:D((()=>[N(r,{prop:"id",label:"id",align:"center","show-overflow-tooltip":""}),N(r,{prop:"choose_id",label:"选择id",align:"center","show-overflow-tooltip":""}),N(r,{prop:"content",label:"内容","show-overflow-tooltip":"",align:"center"}),N(r,{prop:"state",label:"状态",align:"center",width:"60"}),N(r,{prop:"create_time",label:"创建时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),N(r,{prop:"update_time",label:"更新时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),N(r,{label:"操作",align:"center",fixed:"right",width:"180"},{default:D((t=>[N(n,{onClick:a=>e.handleEdit(t.row)},{default:D((()=>[H])),_:2},1032,["onClick"]),N(p,{title:"删除",onConfirm:a=>e.handleDel(t.row)},{reference:D((()=>[N(n,{type:"danger"},{default:D((()=>[Q])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData"]),[[f,e.loading]])]),e.layer.show?(i(),C(g,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):x("",!0)])}],["__scopeId","data-v-73e97957"]])},setup(){let e=o({});k("active",e)}}),X={class:"full"},Y={class:"left"},Z={class:"content"};var ee=n(W,[["render",function(e,t,a,o,l,s){const n=_("Choose"),r=_("ContentTable");return i(),d("div",X,[m("div",Y,[N(n)]),m("div",Z,[N(r)])])}],["__scopeId","data-v-d45d5926"]]);export{ee as default};
