import{T as e}from"./index.c3d311dd.js";import{d as a}from"./utils.3dd1a93e.js";import{q as t,d as l,L as o,k as r,j as n,x as s,_ as i,r as p,o as d,z as m,w as u,b as c,c as h,K as g,M as f,a as b,A as _,B as w,C as v,f as y}from"./index.a5d69c1c.js";import{P as D,g as C}from"./portmappoint.1a4f3057.js";import{s as F}from"./point.12d7b59d.js";import{S as M}from"./Search.02417c9e.js";const S=l({components:{Layer:o,Plus:D},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"600px"})}},setup(){const e=r(null),a=r(null),t=r({}),l=n({pageNum:1,pageSize:40}),o=r([]),i=r([]),p=r(null),d=()=>{C().then((e=>{o.value=e.data})).catch((e=>{s.error(res.msg)}))};return d(),{layerDom:e,formRef:a,modeForm:t,rules:{point_id:[{required:!0,message:"请选择需要对应的点位",trigger:"blur"}]},pointList:i,portMapPointData:o,page:l,uploadRef:p,getPortMapPointData:d,changePortPointMap:e=>{if(e){const a={pageNum:l.pageNum,pageSize:l.pageSize,port_point_map_id:e};F(a).then((e=>{let a=e.data.list;i.value=a})).catch((e=>{s.success(e),i.value=[],l.pageNum=1,l.total=0}))}}}},methods:{submit(){this.formRef&&this.formRef.validate((e=>{if(e){let e=this.modeForm,a=this.uploadRef.uploadFiles;if(this.layer.row){let t=this.layer.row.id;this.httpRequest(a,e,t)}else this.httpRequest(a,e)}}))},httpRequest(e,a,l){const o=new FormData;e.forEach((e=>{o.append("image",e.raw)})),o.append("point_id",a.point_id),l?(o.append("id",l),(e=>t({url:"/waveforms/update",method:"post",data:e}))(o).then((e=>{s.success(e.msg)})).catch((e=>{s.error(res.msg),console.log("err",e)}))):(e=>t({url:"/waveforms/upload",method:"post",data:e}))(o).then((e=>{s.success({message:e.msg})})).catch((e=>{s.error(res.msg)})),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()}}}),P=b("div",{class:"el-upload__tip"},"请选择波形图，格式为jpg/png",-1);const R=l({name:"WaveForms",components:{Table:e,Upload:i(S,[["render",function(e,a,t,l,o,r){const n=p("plus"),s=p("el-icon"),i=p("el-upload"),b=p("el-form-item"),_=p("el-option"),w=p("el-select"),v=p("el-form"),y=p("Layer");return d(),m(y,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:u((()=>[c(v,{ref:"formRef",model:e.modeForm,rules:e.rules,"label-width":"120px"},{default:u((()=>[c(b,{label:"波形图",prop:"image"},{default:u((()=>[c(i,{ref:"uploadRef",action:"","list-type":"picture-card",name:"image",accept:".jpg, .png",limit:"1","auto-upload":!1,"http-request":e.httpRequest},{tip:u((()=>[P])),default:u((()=>[c(s,null,{default:u((()=>[c(n)])),_:1})])),_:1},8,["http-request"])])),_:1}),c(b,{label:"港口点位地图",prop:"port_point_map_id"},{default:u((()=>[c(w,{modelValue:e.modeForm.port_point_map_id,"onUpdate:modelValue":a[0]||(a[0]=a=>e.modeForm.port_point_map_id=a),placeholder:"请选择港口点位地图",clearable:"",onChange:e.changePortPointMap},{default:u((()=>[(d(!0),h(f,null,g(e.portMapPointData,(e=>(d(),m(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),c(b,{label:"点位表",prop:"point_id"},{default:u((()=>[c(w,{modelValue:e.modeForm.point_id,"onUpdate:modelValue":a[1]||(a[1]=a=>e.modeForm.point_id=a),placeholder:"请选择点位表，根据点位表分类选择",clearable:""},{default:u((()=>[(d(!0),h(f,null,g(e.pointList,(e=>(d(),m(_,{key:e.id,label:e.content,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["layer","onConfirm"])}]]),Search:M},setup(){const e=r(!0),l=r([]),o=n({pageNum:1,pageSize:10,total:0}),s=r([]),i=n({show:!1,title:"添加波形图",showButton:!0,width:"600px"}),p=a=>{e.value=!0,a&&(o.pageNum=1);const r={pageNum:o.pageNum,pageSize:o.pageSize};var n;(n=r,t({url:"/waveforms/findAll",method:"post",data:n})).then((e=>{let a=e.data.list;l.value=a,o.total=Number(e.data.total)})).catch((e=>{ElMessage.error(e),l.value=[],o.pageNum=1,o.total=0})).finally((()=>{e.value=!1}))},d=r([]),m=()=>{C().then((e=>{d.value=e.data})).catch((e=>{ElMessage.error(res.msg)}))};return p(!0),m(),{loading:e,tableData:l,page:o,chooseData:s,baseURL:"http://8.131.240.89:5050/waveforms/search?id=",dateFormat:a,layer:i,portMapPointData:d,getTableData:p,handleSelectionChange:e=>{s.value=e},uploadWaveForms:()=>{i.title="添加波形图",i.show=!0,i.width="600px"},handleBatchDel:e=>{let a=[];e.map((e=>{a.push(e.id)}));var o;(o={waveformsIds:a},t({url:"/waveforms/batch/delete",method:"post",data:o})).then((e=>{ElMessage.success(e.msg),p(1===l.value.length)})).catch((e=>{ElMessage.error(e)}))},handleEdit:e=>{i.title="编辑波形图",i.show=!0,i.row=e,i.width="600px"},handleDel:e=>{if(e){(e=>t({url:"/waveforms/delete",method:"get",params:e}))({id:e.id}).then((e=>{ElMessage.success(e.msg),p(1===l.value.length)})).catch((e=>{ElMessage.error(e)}))}},getPortMapPointData:m}}}),x={class:"layout-container"},T={class:"layout-container-form flex space-between"},j={class:"layout-container-form-handle"},k=y("上传波形图"),N=y("批量删除"),E={class:"layout-container-form-search"},V=y("搜索"),q={class:"layout-container-table"},U=y("编辑"),z=y("删除");var L=i(R,[["render",function(e,a,t,l,o,r){const n=p("el-button"),s=p("el-popconfirm"),i=p("el-option"),y=p("el-select"),D=p("el-table-column"),C=p("el-image"),F=p("Table"),M=p("Upload"),S=_("loading");return d(),h("div",x,[b("div",T,[b("div",j,[c(n,{type:"primary",icon:"el-icon-plus",onClick:e.uploadWaveForms},{default:u((()=>[k])),_:1},8,["onClick"]),c(s,{title:"批量删除",onConfirm:a[0]||(a[0]=a=>e.handleBatchDel(e.chooseData))},{reference:u((()=>[c(n,{type:"danger",icon:"el-icon-delete",disabled:0===e.chooseData.length},{default:u((()=>[N])),_:1},8,["disabled"])])),_:1})]),b("div",E,[c(y,{modelValue:e.page.port_point_map_id,"onUpdate:modelValue":a[1]||(a[1]=a=>e.page.port_point_map_id=a),placeholder:"请选择港口点位地图",clearable:""},{default:u((()=>[(d(!0),h(f,null,g(e.portMapPointData,(e=>(d(),m(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),c(n,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:a[2]||(a[2]=a=>e.getSearchWaveForms(!0))},{default:u((()=>[V])),_:1})])]),b("div",q,[w(c(F,{ref:"table",page:e.page,"onUpdate:page":a[3]||(a[3]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:u((()=>[c(D,{prop:"id",label:"id",align:"center","show-overflow-tooltip":""}),c(D,{prop:"point_id",label:"点位表id",align:"center","show-overflow-tooltip":""}),c(D,{prop:"url",label:"图片路径",align:"center",width:"70","show-overflow-tooltip":""}),c(D,{prop:"path",label:"图片存储路径",align:"center"},{default:u((a=>[c(C,{class:"image-style",src:e.baseURL+a.row.id,fit:e.cover},null,8,["src","fit"])])),_:1}),c(D,{prop:"type",label:"图片类型",align:"center",width:"80"}),c(D,{prop:"name",label:"图片名称",align:"center",width:"80"}),c(D,{prop:"state",label:"状态",align:"center",width:"60"}),c(D,{prop:"create_time",label:"创建时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),c(D,{prop:"update_time",label:"更新时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),c(D,{label:"操作",align:"center",fixed:"right",width:"180"},{default:u((a=>[c(n,{onClick:t=>e.handleEdit(a.row)},{default:u((()=>[U])),_:2},1032,["onClick"]),c(s,{title:"删除",onConfirm:t=>e.handleDel(a.row)},{reference:u((()=>[c(n,{type:"danger"},{default:u((()=>[z])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData","onSelectionChange"]),[[S,e.loading]]),e.layer.show?(d(),m(M,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):v("",!0)])])}],["__scopeId","data-v-e7e1eb2e"]]);export{L as default};
