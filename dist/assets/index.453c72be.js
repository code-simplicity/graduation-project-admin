import{T as e}from"./index.c3d311dd.js";import{d as a,o as l,z as t,b as o,q as r,L as n,k as d,J as i,x as s,_ as p,r as c,w as u,c as m,K as h,M as v,a as f,j as w,A as b,B as g,C as _,f as y}from"./index.a5d69c1c.js";import{g as V}from"./choose.f9744687.js";var D=a({name:"VideoCamera"});const k={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},C=o("path",{fill:"currentColor",d:"M704 768V256H128v512h576zm64-416 192-96v512l-192-96v128a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V224a32 32 0 0 1 32-32h640a32 32 0 0 1 32 32v128zm0 71.552v176.896l128 64V359.552l-128 64zM192 320h192v64H192v-64z"},null,-1);D.render=function(e,a,o,r,n,d){return l(),t("svg",k,[C])},D.__file="packages/components/VideoCamera.vue";const x=a({components:{Layer:n,VideoCamera:D},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"600px"})}},setup(e){const a=d(null),l=d(null),t=d({water_level:"",wave_direction:"",embank_ment:""}),o=d(null),r=d([]),n=i((()=>r.value.slice(0,4))),p=i((()=>r.value.slice(4,7))),c=i((()=>r.value.slice(7,11)));return e.layer.row&&(t.value=JSON.parse(JSON.stringify(e.layer.row))),V({pageNum:1,pageSize:20}).then((e=>{let a=e.data.list;r.value=a})).catch((e=>{s.error(res.msg),console.log("err",e)})),{layerDom:a,formRef:l,modeForm:t,uploadRef:o,chooseData:r,chooseWaterLevel:n,chooseWaveDirection:p,chooseeMbankMent:c}},methods:{submit(){this.formRef.validate((e=>{if(e){let e=this.modeForm,a=this.uploadRef.uploadFiles;if(this.layer.row){let l=this.layer.row.id;this.httpRequest(a,e,l)}else this.httpRequest(a,e)}}))},httpRequest(e,a,l){const t=new FormData;e.forEach((e=>{t.append("video",e.raw)})),t.append("water_level",a.water_level),t.append("wave_direction",a.wave_direction),t.append("embank_ment",a.embank_ment),l?(t.append("id",l),(e=>r({url:"/video/update",method:"post",data:e}))(t).then((e=>{s.success(e.msg)})).catch((e=>{s.error(res.msg)}))):(e=>r({url:"/video/upload",method:"post",data:e}))(t).then((e=>{s.success(e.msg)})).catch((e=>{s.error(res.msg)})),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()}}}),F=f("div",{class:"el-upload__tip"},"请选择视频，格式为mp4",-1);const S=a({name:"VideoSetting",components:{Table:e,Layer:p(x,[["render",function(e,a,r,n,d,i){const s=c("video-camera"),p=c("el-icon"),f=c("el-upload"),w=c("el-form-item"),b=c("el-option"),g=c("el-select"),_=c("el-form"),y=c("Layer",!0);return l(),t(y,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:u((()=>[o(_,{ref:"formRef",model:e.modeForm,"label-width":"80px"},{default:u((()=>[o(w,{label:"视频",prop:"video"},{default:u((()=>[o(f,{ref:"uploadRef",action:"","list-type":"picture-card",name:"video",accept:".mp4",limit:"1","auto-upload":!1,"http-request":e.httpRequest},{tip:u((()=>[F])),default:u((()=>[o(p,null,{default:u((()=>[o(s)])),_:1})])),_:1},8,["http-request"])])),_:1}),o(w,{label:"设计水位",prop:"water_level"},{default:u((()=>[o(g,{modelValue:e.modeForm.water_level,"onUpdate:modelValue":a[0]||(a[0]=a=>e.modeForm.water_level=a),placeholder:"请选择设计水位",clearable:""},{default:u((()=>[(l(!0),m(v,null,h(e.chooseWaterLevel,(e=>(l(),t(b,{key:e.id,label:e.content,value:e.content},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(w,{label:"波浪来向",prop:"wave_direction"},{default:u((()=>[o(g,{modelValue:e.modeForm.wave_direction,"onUpdate:modelValue":a[1]||(a[1]=a=>e.modeForm.wave_direction=a),placeholder:"请选择波浪来向",clearable:""},{default:u((()=>[(l(!0),m(v,null,h(e.chooseWaveDirection,(e=>(l(),t(b,{key:e.id,label:e.content,value:e.content},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(w,{label:"外堤布置",prop:"embank_ment"},{default:u((()=>[o(g,{modelValue:e.modeForm.embank_ment,"onUpdate:modelValue":a[2]||(a[2]=a=>e.modeForm.embank_ment=a),placeholder:"请选择外堤布置",clearable:""},{default:u((()=>[(l(!0),m(v,null,h(e.chooseeMbankMent,(e=>(l(),t(b,{key:e.id,label:e.content,value:e.content},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["layer","onConfirm"])}]])},setup(){const e=d(!0),a=d([]),l=w({pageNum:1,pageSize:10,total:0}),t=d([]),o=w({water_level:"",wave_direction:"",embank_ment:""}),n=w({show:!1,title:"添加视频",showButton:!0,width:"600px"}),i=t=>{e.value=!0,t&&(l.pageNum=1);const o={pageNum:l.pageNum,pageSize:l.pageSize};var n;(n=o,r({url:"/video/findAll",method:"post",data:n})).then((e=>{let t=e.data.list;a.value=t,l.total=Number(e.data.total)})).catch((e=>{s.error(e),a.value=[],l.pageNum=1,l.total=0})).finally((()=>{e.value=!1}))};return i(!0),{loading:e,tableData:a,page:l,layer:n,baseURL:"http://8.131.240.89:5050/video/search?id=",input:o,chooseData:t,handleAddVideo:()=>{n.title="添加视频",n.show=!0,n.width="600px"},handleDel:e=>{(e=>r({url:"/video/delete",method:"get",params:e}))({id:e.id}).then((e=>{s.success(e.msg),i(1===a.value.length)})).catch((e=>{s.error(res.msg)}))},handleEdit:e=>{n.title="编辑视频",n.show=!0,n.row=e,n.width="600px"},getTableData:i,handleSelectionChange:e=>{t.value=e},handleBatchDel:e=>{let l=[];e.map((e=>{l.push(e.id)}));var t;(t={videoIds:l},r({url:"/video/batch/delete",method:"post",data:t})).then((e=>{s.success(e.msg),i(1===a.value.length)})).catch((e=>{s.error(res.msg)}))}}}}),R={class:"layout-container"},T={class:"layout-container-form flex space-between"},z={class:"layout-container-form-handle"},L=y(" 添加视频"),N=y("批量删除"),U={class:"layout-container-form-search"},M=y("搜索"),q={class:"layout-container-table"},B=["src"],j=y("编辑"),A=y("删除");var G=p(S,[["render",function(e,a,r,n,d,i){const s=c("el-button"),p=c("el-popconfirm"),h=c("el-input"),v=c("el-col"),w=c("el-row"),y=c("el-table-column"),V=c("Table"),D=c("Layer"),k=b("loading");return l(),m("div",R,[f("div",T,[f("div",z,[o(s,{type:"primary",icon:"el-icon-plus",onClick:e.handleAddVideo},{default:u((()=>[L])),_:1},8,["onClick"]),o(p,{title:"批量删除",onConfirm:a[0]||(a[0]=a=>e.handleBatchDel(e.chooseData))},{reference:u((()=>[o(s,{type:"danger",icon:"el-icon-delete",disabled:0===e.chooseData.length},{default:u((()=>[N])),_:1},8,["disabled"])])),_:1})]),f("div",U,[o(w,{gutter:10},{default:u((()=>[o(v,{span:8},{default:u((()=>[o(h,{modelValue:e.input.water_level,"onUpdate:modelValue":a[1]||(a[1]=a=>e.input.water_level=a),placeholder:"设计水位",clearable:""},null,8,["modelValue"])])),_:1}),o(v,{span:8},{default:u((()=>[o(h,{modelValue:e.input.wave_direction,"onUpdate:modelValue":a[2]||(a[2]=a=>e.input.wave_direction=a),placeholder:"波浪来向",clearable:""},null,8,["modelValue"])])),_:1}),o(v,{span:8},{default:u((()=>[o(h,{modelValue:e.input.embank_ment,"onUpdate:modelValue":a[3]||(a[3]=a=>e.input.embank_ment=a),placeholder:"外堤布置",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),o(s,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:a[4]||(a[4]=a=>e.getSearchPortMapPoint(!0))},{default:u((()=>[M])),_:1})])]),f("div",q,[g(o(V,{ref:"table",page:e.page,"onUpdate:page":a[5]||(a[5]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:u((()=>[o(y,{prop:"id",label:"id","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"url",label:"视频路径","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"path",label:"视频存储路径","show-overflow-tooltip":"",align:"center",width:"200"},{default:u((a=>[f("video",{class:"video-style",src:e.baseURL+a.row.id,controls:""},null,8,B)])),_:1}),o(y,{prop:"type",label:"视频类型","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"name",label:"视频名称","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"state",label:"视频状态","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"water_level",label:"设计水位","show-overflow-tooltip":"",align:"center",width:"120"}),o(y,{prop:"wave_direction",label:"波浪来向","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"embank_ment",label:"外堤布置","show-overflow-tooltip":"",align:"center"}),o(y,{prop:"create_time",label:"创建时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),o(y,{prop:"update_time",label:"更新时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),o(y,{label:"操作",align:"center",fixed:"right",width:"180"},{default:u((a=>[o(s,{onClick:l=>e.handleEdit(a.row)},{default:u((()=>[j])),_:2},1032,["onClick"]),o(p,{title:"删除",onConfirm:l=>e.handleDel(a.row)},{reference:u((()=>[o(s,{type:"danger"},{default:u((()=>[A])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData","onSelectionChange"]),[[k,e.loading]]),e.layer.show?(l(),t(D,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):_("",!0)])])}],["__scopeId","data-v-d6110464"]]);export{G as default};
