import{d as e}from"./utils.3dd1a93e.js";import{T as a}from"./index.c3d311dd.js";import{q as l,d as t,L as o,k as r,v as s,x as d,y as n,_ as u,r as i,o as c,z as p,w as m,b as h,a as f,j as g,A as b,c as y,B as w,f as _,t as x,C as D,D as v,E as U,F as C,G as V}from"./index.a5d69c1c.js";import{U as S}from"./UploadFilled.9cb33ab5.js";import{S as T}from"./Search.02417c9e.js";var k=u(t({components:{Layer:o},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"400px"})}},setup(e){const a=r(null),l=r(null),t=r({id:""});return e.layer.row&&(t.value=JSON.parse(JSON.stringify(e.layer.row))),{rules:{id:[{required:!0,message:"请输入学号",trigger:"blur"}],user_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"blur"}],state:[{required:!0,message:"请选择状态,默认为在线",trigger:"blur"}],score:[{required:!0,message:"请输入该学生的得分",trigger:"blur"}]},form:t,ruleForm:a,layerDom:l}},methods:{submit(){this.ruleForm&&this.ruleForm.validate((e=>{if(e){let e=this.form;this.layer.row?this.updateUser(e):this.addUser(e)}}))},addUser(e){s(e).then((e=>{d.success({message:e.msg}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})).catch((e=>{d.error({message:res.msg})}))},updateUser(e){n(e).then((e=>{d.success(e.msg),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})).catch((e=>{d.error({message:res.msg})}))}}}),[["render",function(e,a,l,t,o,r){const s=i("el-input"),d=i("el-form-item"),n=i("el-option"),u=i("el-select"),f=i("el-form"),g=i("Layer",!0);return c(),p(g,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:m((()=>[h(f,{rules:e.rules,ref:"ruleForm",model:e.form,"label-width":"60px"},{default:m((()=>[h(d,{label:"学号",prop:"id"},{default:m((()=>[h(s,{modelValue:e.form.id,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.id=a)},null,8,["modelValue"])])),_:1}),h(d,{label:"姓名",prop:"user_name"},{default:m((()=>[h(s,{modelValue:e.form.user_name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.user_name=a)},null,8,["modelValue"])])),_:1}),h(d,{label:"密码",prop:"password"},{default:m((()=>[h(s,{modelValue:e.form.password,"onUpdate:modelValue":a[2]||(a[2]=a=>e.form.password=a),type:"password"},null,8,["modelValue"])])),_:1}),h(d,{label:"得分",prop:"score"},{default:m((()=>[h(s,{modelValue:e.form.score,"onUpdate:modelValue":a[3]||(a[3]=a=>e.form.score=a)},null,8,["modelValue"])])),_:1}),h(d,{label:"角色",prop:"roles"},{default:m((()=>[h(u,{modelValue:e.form.roles,"onUpdate:modelValue":a[4]||(a[4]=a=>e.form.roles=a),placeholder:"请选择"},{default:m((()=>[h(n,{label:"管理员",value:"admin"}),h(n,{label:"普通用户",value:"user"})])),_:1},8,["modelValue"])])),_:1}),h(d,{label:"状态",prop:"state"},{default:m((()=>[h(u,{modelValue:e.form.state,"onUpdate:modelValue":a[5]||(a[5]=a=>e.form.state=a),placeholder:"请选择状态"},{default:m((()=>[h(n,{label:"存在",value:"1"}),h(n,{label:"已删除",value:"0"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["layer","onConfirm"])}]]);const E=t({name:"Upload",components:{Layer:o,UploadFilled:S},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"400px"})}},setup:()=>({uploadRef:r(null),layerDom:r(null)}),methods:{httpRequest(e){const a=new FormData;var t;e.forEach((e=>{a.append("file",e.raw)})),(t=a,l({url:"/excel/upload",method:"post",data:t})).then((e=>{d.success({message:e.msg})})).catch((e=>{d.error({message:res.msg}),console.log("err",e)}))},submit(){this.uploadRef&&(this.httpRequest(this.uploadRef.uploadFiles),this.layerDom&&this.layerDom.close())}}}),N=f("div",{slot:"tip",class:"el-upload__text"},"请选择对应的excel模板",-1);const q=t({name:"user",components:{Table:a,Search:T,Layer:k,Upload:u(E,[["render",function(e,a,l,t,o,r){const s=i("upload-filled"),d=i("el-icon"),n=i("el-upload"),u=i("Layer");return c(),p(u,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:m((()=>[h(n,{ref:"uploadRef",name:"file",action:"",accept:".xlsx, .xls",drag:"","auto-upload":!1,"http-request":e.httpRequest},{default:m((()=>[h(d,{size:"120",class:"el-icon--upload"},{default:m((()=>[h(s)])),_:1}),N])),_:1},8,["http-request"])])),_:1},8,["layer","onConfirm"])}]])},setup(){const a=g({pageNum:1,pageSize:10,total:0,pages:0,user:""}),l=g({show:!1,title:"添加用户",showButton:!0,width:"400px"}),t=g({show:!1,title:"导入用户",showButton:!0,width:"400px"}),o=r(!0),s=r([]),n=r([]),u=e=>{o.value=!0,e&&(a.pageNum=1);let l={pageNum:a.pageNum,pageSize:a.pageSize};v(l).then((e=>{let l=e.data.list;s.value=l,a.total=Number(e.data.total)})).catch((e=>{d.error(e),s.value=[],a.pageNum=1,a.total=0})).finally((()=>{o.value=!1}))};return u(!0),{page:a,loading:o,tableData:s,chooseData:n,layer:l,upload:t,dateFormat:e,handleSelectionChange:e=>{n.value=e},getTableData:u,getSearchUserData:e=>{o.value=!0,e&&(a.pageNum=1);let l={pageNum:a.pageNum,pageSize:a.pageSize,user:a.user};U(l).then((e=>{let l=e.data.list;s.value=l,d.success(e.msg),o.value=!1,a.total=Number(e.data.total)})).catch((e=>{d.error(e),s.value=[],a.pageNum=1,a.total=0}))},handleAddUser:()=>{l.title="添加用户",l.show=!0,delete l.row,l.width="400px"},handleEdit:e=>{l.title="编辑数据",l.row=e,l.show=!0,l.width="400px"},handleDel:e=>{const a={id:e.id};C(a).then((e=>{d.success(e.msg),u(1===s.value.length)})).catch((e=>{d.error(e.msg)}))},handleUploadExcel:()=>{t.title="导入用户",t.show=!0,t.width="400px"},handleBatchDel:e=>{let a=[];e.map((e=>{a.push(e.id)}));V({userIds:a}).then((e=>{d.success(e.msg),u(1===s.value.length)})).catch((e=>{d.error(res.msg)}))}}},methods:{handleExportUser(){if(!this.chooseData.length)return d.warning({message:"请勾选要导出的数据！"}),!1;let e=[];this.chooseData.map((a=>{e.push(a.id)}));(e=>l({url:"/excel/export/user",method:"post",responseType:"blob",data:e}))({exportIds:e}).then((e=>{this.downloadExcel(e),d.success({message:"导出数据成功,请保存."})})).catch((e=>{console.log("err",e)}))},handleDownloadExcel(){l({url:"/excel/export",method:"get",responseType:"blob"}).then((e=>{this.downloadExcel(e),d.success({message:"用户模板下载成功.",duration:2e3})}))},downloadExcel(e){if(!e)return"";let a=window.URL.createObjectURL(new Blob([e])),l=document.createElement("a");l.style.display="none",l.href=a,l.setAttribute("download","用户模板.xlsx"),document.body.appendChild(l),l.click()}}}),F={class:"layout-container"},j={class:"layout-container-form flex space-between"},L={class:"layout-container-form-handle"},R=_("新增"),B=_("批量导入"),z=_("批量导出"),G=_("模板下载"),O=_("批量删除"),A={class:"layout-container-form-search"},I=_("搜索"),J={class:"layout-container-table"},$=_("编辑"),H=_("删除");var K=u(q,[["render",function(e,a,l,t,o,r){const s=i("el-button"),d=i("el-popconfirm"),n=i("search"),u=i("el-icon"),g=i("el-input"),v=i("el-table-column"),U=i("el-tag"),C=i("Table"),V=i("Layer"),S=i("Upload"),T=b("loading");return c(),y("div",F,[f("div",j,[f("div",L,[h(s,{type:"primary",icon:"el-icon-plus",onClick:e.handleAddUser},{default:m((()=>[R])),_:1},8,["onClick"]),h(s,{type:"success",icon:"el-icon-folder-checked",onClick:e.handleUploadExcel},{default:m((()=>[B])),_:1},8,["onClick"]),h(s,{type:"info",icon:"el-icon-takeaway-box",onClick:e.handleExportUser},{default:m((()=>[z])),_:1},8,["onClick"]),h(s,{icon:"el-icon-download",onClick:e.handleDownloadExcel},{default:m((()=>[G])),_:1},8,["onClick"]),h(d,{title:"批量删除",onConfirm:a[0]||(a[0]=a=>e.handleBatchDel(e.chooseData))},{reference:m((()=>[h(s,{type:"danger",icon:"el-icon-delete",disabled:0===e.chooseData.length},{default:m((()=>[O])),_:1},8,["disabled"])])),_:1})]),f("div",A,[h(g,{modelValue:e.page.user,"onUpdate:modelValue":a[1]||(a[1]=a=>e.page.user=a),placeholder:"学号/用户名",clearable:""},{prefix:m((()=>[h(u,{class:"el-input__icon"},{default:m((()=>[h(n)])),_:1})])),_:1},8,["modelValue"]),h(s,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:a[2]||(a[2]=a=>e.getSearchUserData(!0))},{default:m((()=>[I])),_:1})])]),f("div",J,[w(h(C,{ref:"table",page:e.page,"onUpdate:page":a[3]||(a[3]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:m((()=>[h(v,{prop:"id",label:"学号",align:"center"}),h(v,{prop:"user_name",label:"姓名",align:"center"}),h(v,{prop:"roles",label:"角色",align:"center"}),h(v,{prop:"state",label:"状态",align:"center",width:"80"},{default:m((e=>[h(U,{type:"1"===e.row.state?"primary":"danger"},{default:m((()=>[_(x("1"===e.row.state?"存在":"已删除"),1)])),_:2},1032,["type"])])),_:1}),h(v,{prop:"score",label:"得分",align:"center",width:"80"}),h(v,{prop:"create_time",label:"创建时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),h(v,{prop:"update_time",label:"更新时间",formatter:e.dateFormat,align:"center","show-overflow-tooltip":""},null,8,["formatter"]),h(v,{label:"操作",align:"center",fixed:"right",width:"200"},{default:m((a=>[h(s,{onClick:l=>e.handleEdit(a.row)},{default:m((()=>[$])),_:2},1032,["onClick"]),h(d,{title:"删除",onConfirm:l=>e.handleDel(a.row)},{reference:m((()=>[h(s,{type:"danger"},{default:m((()=>[H])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData","onSelectionChange"]),[[T,e.loading]]),e.layer.show?(c(),p(V,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):D("",!0),h(S,{layer:e.upload,"v-if":e.upload.show,onGetTableData:e.getTableData},null,8,["layer","v-if","onGetTableData"])])])}],["__scopeId","data-v-06bb64e0"]]);export{K as default};
