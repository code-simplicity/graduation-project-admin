import{T as e}from"./index.c3d311dd.js";import{d as a}from"./utils.3dd1a93e.js";import{u as t,a as l,g as o,d as r,s as n}from"./point.12d7b59d.js";import{g as i,P as s}from"./portmappoint.1a4f3057.js";import{d as p,L as d,k as m,x as u,_ as c,r as g,o as f,z as h,w as _,b,c as y,K as w,M as v,j as D,A as P,a as x,B as N,C as V,f as S}from"./index.a5d69c1c.js";const T=p({components:{Layer:d},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0,width:"400px"})}},setup(e){const a=m(null),t=m({port_point_map_id:""}),l=m(null),o=m([]),r=()=>{i().then((e=>{o.value=e.data})).catch((e=>{u.error(res.msg)}))};return e.layer.row&&(t.value=JSON.parse(JSON.stringify(e.layer.row))),r(),{layerDom:a,modeForm:t,formRef:l,rules:{port_point_map_id:[{required:!0,message:"请选择港口点位图对应的值",trigger:"blur"}],content:[{required:!0,message:"请输入内容,输入值必须是在1到39之间",trigger:"blur"}]},portMapPointData:o,getPortMapPointData:r}},methods:{submit(){this.formRef&&this.formRef.validate((e=>{if(e){let e=this.modeForm;this.layer.row?t(e):l(e),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()}}))},addPoint(e){l(e).then((e=>{u.success({message:e.msg})})).catch((e=>{u.error(res.msg)}))},updatePoint(e){t(e).then((e=>{u.success(e.msg)})).catch((e=>{u.error(res.msg)}))}}});const C=p({name:"PointSetting",components:{Plus:s,Table:e,Layer:c(T,[["render",function(e,a,t,l,o,r){const n=g("el-option"),i=g("el-select"),s=g("el-form-item"),p=g("el-col"),d=g("el-row"),m=g("el-input"),u=g("el-form"),c=g("Layer",!0);return f(),h(c,{layer:e.layer,ref:"layerDom",onConfirm:e.submit},{default:_((()=>[b(u,{ref:"formRef",model:e.modeForm,rules:e.rules,"label-width":"120px"},{default:_((()=>[b(d,{gutter:10},{default:_((()=>[b(p,{span:24},{default:_((()=>[b(s,{label:"港口点位地图",prop:"port_point_map_id"},{default:_((()=>[b(i,{modelValue:e.modeForm.port_point_map_id,"onUpdate:modelValue":a[0]||(a[0]=a=>e.modeForm.port_point_map_id=a),placeholder:"请选择港口点位地图",clearable:""},{default:_((()=>[(f(!0),y(v,null,w(e.portMapPointData,(e=>(f(),h(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),b(d,{gutter:10},{default:_((()=>[b(p,{span:22},{default:_((()=>[b(s,{label:"内容",prop:"content"},{default:_((()=>[b(m,{modelValue:e.modeForm.content,"onUpdate:modelValue":a[1]||(a[1]=a=>e.modeForm.content=a),placeholder:"请输入内容",max:"39",min:"1",type:"number"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["layer","onConfirm"])}]])},setup(){const e=m(!0),t=m([]),l=D({pageNum:1,pageSize:10,total:0,pages:0,port_point_map_id:"",content:""}),s=D({show:!1,title:"添加点位",showButton:!0,width:"400px"}),p=a=>{e.value=!0,a&&(l.pageNum=1);const r={pageNum:l.pageNum,pageSize:l.pageSize};o(r).then((e=>{let a=e.data.list;t.value=a,l.total=Number(e.data.total)})).catch((a=>{u.error(a),e.value=!1,t.value=[],l.pageNum=1,l.total=0})).finally((()=>{e.value=!1}))},d=m([]),c=()=>{i().then((e=>{d.value=e.data})).catch((e=>{u.error(res.msg)}))};return p(!0),c(),{tableData:t,page:l,dateFormat:a,layer:s,portMapPointData:d,getTableData:p,handleAddPoint:()=>{s.title="添加点位",s.show=!0,s.width="400px"},handleDel:e=>{let a={id:e.id};r(a).then((e=>{u.success({message:e.msg}),p(1===t.value.length)})).catch((e=>{u.error({message:res.msg})}))},handleEdit:e=>{s.title="编辑点位",s.show=!0,s.width="400px",s.row=e},getPortMapPointData:c,getSearchPoint:a=>{e.value=!0,a&&(l.pageNum=1);let o={pageNum:l.pageNum,pageSize:l.pageSize,port_point_map_id:l.port_point_map_id,content:l.content};n(o).then((a=>{let o=a.data.list;t.value=o,u.success(a.msg),e.value=!1,l.total=Number(a.data.total)})).catch((e=>{u.success(res.msg),t.value=[],l.pageNum=1,l.total=0}))}}}}),F={class:"layout-container"},k={class:"layout-container-form flex space-between"},j={class:"layout-container-form-handle"},M=S(" 添加点位"),z={class:"layout-container-form-search"},L=S("搜索"),U={class:"layout-container-table"},G=S("编辑"),R=S("删除");var A=c(C,[["render",function(e,a,t,l,o,r){const n=g("el-button"),i=g("el-option"),s=g("el-select"),p=g("el-col"),d=g("el-input"),m=g("el-row"),u=g("el-table-column"),c=g("el-popconfirm"),D=g("Table"),S=g("Layer"),T=P("loading");return f(),y("div",F,[x("div",k,[x("div",j,[b(n,{type:"primary",icon:"el-icon-plus",onClick:e.handleAddPoint},{default:_((()=>[M])),_:1},8,["onClick"])]),x("div",z,[b(m,{gutter:10},{default:_((()=>[b(p,{span:12},{default:_((()=>[b(s,{modelValue:e.page.port_point_map_id,"onUpdate:modelValue":a[0]||(a[0]=a=>e.page.port_point_map_id=a),placeholder:"请选择港口点位地图",clearable:""},{default:_((()=>[(f(!0),y(v,null,w(e.portMapPointData,(e=>(f(),h(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(p,{span:12},{default:_((()=>[b(d,{modelValue:e.page.content,"onUpdate:modelValue":a[1]||(a[1]=a=>e.page.content=a),placeholder:"请输入点位内容",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),b(n,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:a[2]||(a[2]=a=>e.getSearchPoint(!0))},{default:_((()=>[L])),_:1})])]),x("div",U,[N(b(D,{ref:"table",page:e.page,"onUpdate:page":a[3]||(a[3]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData},{default:_((()=>[b(u,{prop:"id",label:"id",align:"center","show-overflow-tooltip":""}),b(u,{prop:"port_point_map_id",label:"港口点位图id",align:"center","show-overflow-tooltip":""}),b(u,{prop:"content",label:"点位内容",align:"center","show-overflow-tooltip":""}),b(u,{prop:"state",label:"状态",align:"center",width:"60","show-overflow-tooltip":""}),b(u,{prop:"create_time",label:"创建时间",formatter:e.dateFormat,align:"center"},null,8,["formatter"]),b(u,{prop:"update_time",label:"更新时间",formatter:e.dateFormat,align:"center"},null,8,["formatter"]),b(u,{label:"操作",align:"center",fixed:"right",width:"180"},{default:_((a=>[b(n,{onClick:t=>e.handleEdit(a.row)},{default:_((()=>[G])),_:2},1032,["onClick"]),b(c,{title:"删除",onConfirm:t=>e.handleDel(a.row)},{reference:_((()=>[b(n,{type:"danger"},{default:_((()=>[R])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData"]),[[T,e.loading]]),e.layer.show?(f(),h(S,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):V("",!0)])])}]]);export{A as default};
